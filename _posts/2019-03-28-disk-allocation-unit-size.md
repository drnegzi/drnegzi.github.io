---
layout: post
title: Disk allocation unit size چیست؟
category: [عمومی]
tags: [Hard disk]
date: 2019-02-16 22:57:00 +0100
published: true
permalink: disk-allocation-unit-size
summary: همه ما هر روز مسئول حل مسائلی حیاتی و مهم در سازمان‌هایی هستیم که در آنها مشغول به فعالیتیم. اما چگونه می‌توان مسائل بزرگ و پیچیده را به اجزایی کوچک‌تر شکست و اهمیت اجزایی که برای رسیدن به موفقیت باید حل شوند را سنجید؟ چگونه می‌توان مسائل را به ساده‌ترین شکل ممکن بیان کرد و به در نهایت به دستور العمل لازم برای رسیدن به موفقیت رسید؟
excerpt_separator: <!--more--> 
uuid: a5d2c075-1f7a-4106-a694-6de0f81166ea
comments: true
series: 
description: بررسی چگونگی ارائه مدل‌ها و راه حل‌های ارائه راهکارهای خلاق و نوآورانه در شرکت‌ها و سازمان‌های بزرگ، به جهت ساده سازی مسائل بزرگ و پیچیده‌ای که هر روز با آنها مواجه می‌شویم.
---
خیلی از افراد در محیط Windows به هنگام format کردن driveهای مختلف، وظیفه مدیریت کردن ویژگی‌های partitionهاشون رو بر عهده سیستم عامل رها می‌کنن. این کار به خودی خود دچار مشکلی نیست، ولی بعضی مواقعی هم وجود دارند که تنظیم این ویژگی‌ها به صورت دستی، برای ما مفیدتر از تنظیمات پیش‌فرض سیستم عامل باشن. در این پست قصد دارم تا در مورد یکی از ویژگی‌های قابل تنظیم در هنگام format کردن driveهایمان، یعنی <span class="highlight-text">allocation unit</span>، و هدف و نحوه بهره‌مند شدن از این ویژگی بنویسم.

قطعا همه کاربران Windows dialogue زیر رو، که موقع format کردن یک drive به نمایش درمیاد رو به خاطر دارند. با هم نگاهی اجمالی به قسمت‌های مختلف این پنجره بیاندازیم:

<img class="post-image image-responsive" src="https://theskn.github.io/assets/img/2016-03-27/theskn-blog-post-jekyll-github-pages-001.png"/>

<span class="font-color-white">Capacity: </span>مشخص کننده میزان ظرفیت کل partitionیست که قصد format کردن آن را داریم.

<span class="font-color-white">Volume lablel: </span>از طریق این ویژگی می‌توانیم برای driveمان یک اسم دلخواد انتخاب کنیم.

<span class="font-color-white">File system: </span>از طریق این گزینه می‌توانیم [file system](https://docs.microsoft.com/en-us/windows/desktop/fileio/file-systems) مورد نظرمان را انتخاب کنیم، در Windows 10 به جز برخی از نسخه‌های Enterprise، حق انتخاب ما محدود به [NTFS](https://docs.microsoft.com/en-us/windows-server/storage/file-server/ntfs-overview) و یا REFS است؛ هر چند که برای partitionهای کوچک، FAT و [FAT32](https://support.microsoft.com/en-au/help/154997/description-of-the-fat32-file-system) هم به این انتخاب‌ها اضافه می‌شوند.

<span class="font-color-white">Perform a quick format: </span>به صورت عادی، دستور format ابتدا drive را به جهت پیدا کردن [bad sector](https://www.howtogeek.com/173463/bad-sectors-explained-why-hard-drives-get-bad-sectors-and-what-you-can-do-about-it/)های احتمالی مورد بررسی قرار می‌دهد. این گزینه باعث می‌شود تا format بدون اجرای این تست، اجرا شود.

<span class="font-color-white">Enable file and folder compression: </span>باعث می‌شود تا در این partition، تمام fileها به صورت فشرده ذخیره شوند. معمولا به دلیل سربار بالای اجرای این ویژگی، از آن استفاده نمی‌شود. همانطور که در تصویر هم می‌بینیم، این ویژگی در نسخه Windows دستگاه من، از طریق format dialogue قابل دسترسی نیست.

<span class="font-color-white">Allocation unit size: </span>به نظر من جالب‌ترین ویژگی این dialogue، همین گزینه است. گزینه‌ای که مقادیر مرموز زیادی بین 4096 تا 2048K را ارائه می‌دهد، ولی ما معمولا آن را به صورت defaul رها می‌کنیم. این مقادیر در واقع مشخص کننده کوچکترین فضایی هستند که می‌تواند به یک file اختصاص یابد. یک partition به واحدهای کوچکتری تقسیم می‌شود.هنگامی که fileها روی یک partition ذخیره می‌شوند، به بخش‌های کوچکتری تقسیم می‌شوند که هر بخش در واقع، داخل یکی از این واحدها قرار می‌گیرد.

پس یک partition با مقدار allocation unit برابر 4096، به بخش‌های کوچکتر که هر کدام 4096 byte هستند، تقسیم می‌شود. برای مثال، یک file با حجم 1MB = 1024K روی partition مفروض، به 250 بخش، تقسیم می‌شود و یا اگر allocation unit ما برابر با 64K باشد، به 16 بخش تقسیم می‌شود. این تفاوت به این معنی است که دستگاه الکترومکانیکی ما به هنگام نوشتن و خواندن این file نزدیک به ۱۶٪ کار کمتری انجام می‌دهد.

این روزها partitionهای NTFS جدید را می‌توان با allocatin unitی معادل با 2048M هم تنظیم کرد که باعث تقسیم شدن فایل‌ها به 2MB می‌شود و جالب اینجاست که هر کدام از این بخش‌ها از ظرفیت یک floppy disk که در دهه ۹۰ کاربرد فراوانی داشت، هم بیشتر است.

مزیت allocation unit بزرگ تنها بر روی HDDها قابل در نظر گرفتن است و روی SSDها نمی‌توان از آن استفاده کرد. چرا که HDDها دستگاه‌های الکترومکانیکی هستند که تحت محدودیدهای فیزیکی قراردارند. کاملا واضح است که هر چه که یک file بیشتر بر روی یک partition پراکنده شده باشد، مدت زمان بیشتری نیاز است تا drive بتواند همه اجزای این file را به دست سیستم عامل برساند. در واقع، به صورت تئوری، هر چه که که یک فایل به قسمت‌هایی با اندازه‌های بزرگ‌تر تقسیم شده باشد، head باید جابجایی کمتری برای خواندن و نوشتن آن file انجام دهد.

اما حالا با یک سوال اساسی مواجه می‌شویم! <span class="font-color-white">پس چرا به صورت پیش‌فرض allication unit همه HDDها برابر با 2046K نیست؟</span> باید به این نکته توجه کنیم که allocation unit در واقع، بیانگر کمترین مقداریست که روی یک drive به یک file اختصاص پیدا میکند. پس در واقع در این حالت یک file کوچک که برای مثال تنها شامل ۲ کاراکتر است و اندازه آن برابر با 2 byte است هم داخل یک واحد به اندازه 2046K ذخیره می‌شود و این به معنی غیرقابل استفاده شدن و هدر رفتن 2047.9K دیگر است. در شرایطی که ما قصد ذخیر کردن تعداد زیادی file با حجم کم داشته باشیم، این fileها باعث هدر رفتن مقدار قابل توجهی از حافظه ما می‌شوند.

<img class="post-image image-responsive" src="https://theskn.github.io/assets/img/2019-03-28/properties-dialogue.png"/>
<img class="post-image image-responsive" src="https://theskn.github.io/assets/img/2019-03-28/firefox-copy-error.png"/>
همانطور که در تصویر اول می‌بینید، ۴۷ fileی که در واقع data fileهای firefox هستند، روی یکی از partitionهای من که allocation unit استاندارد دارد، 3.85MB فضا اشغال کرده‌اند و عکس دوم تلاش من برای انتقال همین file‌ها به partition دیگری است که allocation unit آن برابر با 2048K است. می‎بیند که همان فایل‌ها حالا برای ذخیره شدن نیاز به 126MB فضا دارند و با توجه به کم بودن ظرفیت خالی این partition، انتقال آنها، به مشکل خورده است.

اما شرایطی هم هستند که در اونها امکان به حداقل رساندن میزان این فضای باقیمانده وجود دارد. برای مثال در partitionهایی که صرفا برای ذخیره backupها یا سایر fileهای حجیم مثل ویدئوها، تصاویر با فرمت RAW و یا آرشیوهای حجیم zip از disk imageهایمان. من معمولا برای partitionهایی که برای ذخیره سازی موارد فوق مورد استفاده قرار می‌گیرند، مقدار allocation unit را بزرگ تنظیم می‌کنم؛ چرا که در این شرایط سرعت برای من پارامتر مهم‌تری نسبت به حداکثر فضای آزاد برای ذخیره سازی است.
